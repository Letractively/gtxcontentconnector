<html>
<head>
<script src="jquery-1.2.1.js" type="text/javascript"></script>
<link href="tree.css" rel="stylesheet" type="text/css" />
<script src="tree.js" type="text/javascript"></script>
<script type="text/javascript">

</script>
</head>
<body>
<script type="text/javascript">

var custom = {};
custom.pcrlocation="http://"+location.host+":"+location.port+"/ContentRepository/pcr";
custom.navlocation="http://"+location.host+":"+location.port+"/ContentRepository/nav";

<!--
function SizeHeight()
{
  //find the height of the internal page
  var the_height=document.getElementById('myIframe').contentWindow.document.body.scrollHeight;
  var thisbodyheight = document.body.scrollHeight;
  //change the height of the iframe
  document.getElementById('myIframe').height=(thisbodyheight-80);
}





$(document).ready(function(){
		$.getJSON(custom.pcrlocation+"?filter=object.obj_type==90021&attributes=key&attributes=name&type=json", // load list of objects
			function(data){
				var options="";
				$('<p></p>').html('status: '+data.status).appendTo('#update-target ol');
				if((data!=undefined) && (data.Objects!=undefined))
				{
					$.each(data.Objects,function(i, item){
						options+="<option value=\""+item.attributes.key+"\">"+item.attributes.name+"</option>";
			        }); //close each
		        }
		        options+="<option value=\"\" selected>Alle</options>";
		        $("select#permission").html(options);
		        
		     
        }); //close callback and  $.getJSON(


		$("#myIframe").load(function(){
			SizeHeight();
		});

		$("select#permission").change(function(){
    	var selection=''+$(this).find('option').filter(':selected').val();
    	
	    	$.getJSON(custom.pcrlocation+"?filter=object.obj_type==90021%20AND%20object.key==\""+selection+"\"&attributes=description&type=json", // load list of objects
				function(data){
					var options="";
					if((data!=undefined) && (data.Objects!=undefined))
					{
						$.each(data.Objects,function(i, item){
						    options+=""+item.attributes.description+"<br/>";
				        }); //close each
				    }
			        $("#nav").html("");
			        $("#desc p").html(options);
			        
			     
	        }); //close $.getJSON(
	     if(selection!='')
	     {
	        $.getJSON(custom.navlocation+"?contentid=10002.4&attributes=name&permissions="+selection+"&type=json", // load list of objects
			function(data){
			if(data.Objects)
			{
				initPreTreeBuild();
				var tree=addExpandCollapseAll();
				tree+=process_children(data.Objects);
				$("#nav").html(tree);
		    }   
		     
        	}); //close $.getJSON(
          }
          else
          {
          	$.getJSON(custom.navlocation+"?contentid=10002.4&attributes=name&type=json", // load list of objects
			function(data){
			if(data.Objects)
			{
				initPreTreeBuild();
				var tree=addExpandCollapseAll();
				tree+=process_children(data.Objects);
				$("#nav").html(tree);
		    }   
		     
        	}); //close $.getJSON(
          }
        });
        



		$.getJSON(custom.navlocation+"?contentid=10002.4&attributes=name&type=json", // load list of objects
			function(data){
			if(data.Objects)
			{
				initPreTreeBuild();
				var tree=addExpandCollapseAll();
				tree+=process_children(data.Objects);
				appendTree(tree);
		    }   
		     
        }); //close $.getJSON(
});//close $(document).redy


function process_children(children)
{
			var ret="";
				$.each(children,function(i, item){
					if(item.attributes.name && item.attributes.name!="")
					{
				    	if(item.obj_type=="10002")
				    	{
				    		ret+=startParentNode(item.attributes.name);
				    		if(item.children)
				    		{
				    			ret+=process_children(item.children);
				    		}
				    		ret+=endParentNode();
				    	}
				    	else
				    	{
				    		ret+=addNode(item.attributes.name,"/ContentRepository/ccr_bin?contentid="+item.contentid,"_self");
				    	}
				    	
				    }
  	
		        }); //close each
		       return(ret);
}


</script>

<table border="0" width="100%" height="100%">
<tr height="50"><td valign="top"><select name="permission" id="permission"><option value="">Alle</option>
</select></td><td><div id="desc"><p>&nbsp;</p></div></td></tr>
<tr><td valign="top" width="300"><div id="nav"></div></td><td valign="top"><div id="cont"><iframe id="myIframe" frameborder="0" scrolling="auto"></iframe></div></td></tr>
</table>
</body>
</html>
