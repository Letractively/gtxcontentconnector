<view id="search"
 xmlns="http://www.gentics.com/xml/ns/portal/view">
	
	<listcomponent class="form">
		<properties>
			<property id="cssclass">nobackground</property>
		</properties>
		<content>
			<listcomponent class="group">
				<label>Neue Suchanfrage</label>
				<content>
					
					<textcomponent id="query">
						<label>Suchbegriff</label>
					</textcomponent>
					
					<buttoncomponent>
						<label>Suchen</label>
						<actions>
							<action class="GeneralViewAction">
								<parameters>
									<parameter id="set">view.components.result.properties.searchquery=view.components.query.value</parameter>
									
								</parameters>
							</action>
							<action class="RenderTemplateAction" id="querygenerator">
							<parameters>
								<parameter id="query" mapped="view.components.query.value"/>
								<parameter id="userrole" mapped="portal.user.systemrole"/>
								<parameter id="template"><![CDATA[
									#set($searchquery="((content:$query) OR (binarycontent:$query)) AND (permissions:NULL OR permissions:$userrole)")
								]]></parameter>
							</parameters>
							</action>
							<action class="com.gentics.cr.lucene.GetResultAction" id="fetcher">
								<parameters>
									<parameter id="query" mapped="actions.querygenerator.searchquery"/>
								</parameters>
								<onsuccess>
									<actions>
										<action class="GeneralViewAction">
											<parameters>
												<parameter id="set">view.components.result.items = actions.fetcher.result</parameter>
											</parameters>
										</action>
									</actions>
								</onsuccess>
							</action>
						</actions>
					</buttoncomponent>
								
				</content>
			</listcomponent>
		</content>
	</listcomponent>
	<datasourcelistcomponent id="result">
		<datasource>false</datasource>
		<paging>
			<size>10</size>
		</paging>
		
		<columns>
			<column id="name">
			<label>name</label>
			<actions>
				<action class="DownloadAction">
						<prule>data.object.obj_type == 10008</prule>
						<parameters>
							<parameter id="component">filedownload</parameter>
							<parameter id="content" mapped="data.object.binarycontent" />
							<parameter id="contenttype" mapped="data.object.mimetype" />
							<parameter id="filename" mapped="data.object.name" />
						</parameters>
					</action>
					<action class="TriggerEventAction">
						<prule>object.obj_type != 10008</prule>
						<parameters>
							<parameter id="event">openResult</parameter>
							<parameter id="contentid" mapped="data.object.contentid" />
							<parameter id="object" mapped="data.object" />
						</parameters>
					</action>
			</actions>
			</column>
			<column id="content">
			<label>content</label>
			<properties>
					<property id="style"><![CDATA[float:none;]]></property>
					<property id="suffix"><![CDATA[]]></property>
				</properties>
			</column>
			<column id="binarycontent">
			<label>binarycontent</label>
			<properties>
					<property id="style"><![CDATA[float:none;]]></property>
					<property id="suffix"><![CDATA[]]></property>
				</properties>
			</column>
			
		</columns>
	</datasourcelistcomponent>
</view>